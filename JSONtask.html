<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" href="styles.css" style="text/css">
	</head>
	<body>
		<textarea id="transcriptionText" placeholder="Enter a IIIF canvas"></textarea>
		<div class="rowContainer">
			<span class="rowItem">a</span>
			<span class="rowItem">a</span>
		</div>
		
	
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

		<script>

		var $curCont;
		var $curImg;

		//Handles errors
		window.addEventListener('error',function(e){
		console.log(e)}, true);

		//Handles the storage of information
		var storageHandler = function(unstoredObject){
		document.write(unstoredObject);
		}
		
		//Checks objects from the canvas 
		var basicCheck = function(canvasObject){
		//make array checker it's own function arrayCheckerHelper
			for (n in canvasObject){
				if (canvasObject.hasOwnProperty(n)){
					if (Array.isArray(canvasObject[n]) || typeof(canvasObject) == 'object'){
						document.write(n+":(Array)");
						document.write("<br />");
						arrayCheckerHelper(canvasObject[n]);
						document.write(n+":(/Array)");
						document.write("<br />");				
						}
					if (validChecker(canvasObject[n]) == true){
						storageHandler(n);
						document.write(": ");
						storageHandler(canvasObject[n]);
						document.write("<br />");
					}
				}
			}
		};
		
		var handleURL = function (url) {
			//test if url first (basic test)
			var result = url.search("http");
			if (result > -1) {
				var rexp = /\.jpg/i;
				if (rexp.test(url)) {
					resolveImage(url);
				} else {
					alert("Found a URL, but could not identify it!");
				}
			}	
		};
		
		var resolveImage = function (imgUrl) {
			var img = $("<img src='" + imgUrl + "' />");
			img.on("load", function () {
				//TODO: display the image somewhere here!
			});
		};


		var validChecker = function(objectValue){
		if (objectValue == null){
		return false;
		}

		else if (typeof objectValue === 'string'){
			objectValue.trim();
			if (objectValue.length > 0){
				return true;
			}
		}
		else if (typeof objectValue === 'number'){
			if (objectValue > -1){
				return true;
			}
		}
		else if (typeof objectValue === 'boolean'){
			return true;}
	
		};
			
		var arrayCheckerHelper = function(canvasArray){
			for (var n=0; n<canvasArray.length; n++){
				basicCheck(canvasArray[n]);
			}
		};


		
		var resolveImage = function (imgUrl) {
			var img = $("<img src='" + imgUrl + "' />");
			img.on("load", function () {
				//TODO: display the image somewhere here!
			});
		};
		
		var textline = function (text) {
			$curCont.append("<p>" + text + "</p>");
			$curCont.append("<br />");
		};




		//Parses the canvas in order to obtain necessary data for redrawing the canvas
		//How information will be parsed depends on the type of canvas
		var canvasParser = function(canvas){
			var text = canvas.responseText;
			var parsedCanv = JSON.parse(text);
			console.log(parsedCanv);
			var type = parsedCanv["@type"];
			basicCheck(parsedCanv);
		};


		//Some tests, to be deleted later
		var exampleCanv = "http://165.134.241.141/annotationstore/annotation/55f9da84e4b04dde25a2734c";
		if (exampleCanv.substring(0,4) === "http"){
		var aThing = $.getJSON(exampleCanv, function(){alert("Image successfully obtained.")}).done(function()
		{canvasParser(aThing)}).fail(function(){alert("A problem has been found. Cannot display image.")});
		}
		</script>
	</body>

</html>

